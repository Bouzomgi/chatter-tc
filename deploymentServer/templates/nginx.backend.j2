
# Redirect all traffic to the web server on port 4000
location /api {
    rewrite ^/api(/.*)$ $1 break;

    {% if red_env == 'alpha' %}
    proxy_pass http://backend-alpha:4000; #red
    {% else %}
    proxy_pass http://backend-omega:4000; #red
    {% endif %}
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

{% if enable_test_route == 'true' %}
location /api/test {
    # Remove the /test prefix from the URL
    rewrite ^/api/test(/.*)$ $1 break;

    {% if red_env == 'alpha' %}
    proxy_pass http://backend-omega:4000;
    {% else %}
    proxy_pass http://backend-alpha:4000;
    {% endif %}
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
{% endif %}
